{"version":3,"sources":["search.js"],"names":["async","loadJson","response","fetch","json","map","tmp","id","itemBarcode","name","authorFirstName","authorLastName","category","location","loadSearchData","media","lunr","this","ref","field","boost","medium","add","doSearch","e","idx","preventDefault","searchText","$","val","resultList","document","getElementById","innerHTML","results","search","result","length","targetLocation","replace","targetLink","ready","indexed","addEventListener","event","value","disabled","removeClass","addClass","keyCode"],"mappings":"AAAAA,eAAeC,WACb,IAAIC,QAAiBC,MAAO,cAG5B,aAFiBD,EAASE,QAEdC,KAAIC,IAAO,CAEnBC,GAAMD,EAAIE,YACVC,KAAQH,EAAIG,KACZC,gBAAmBJ,EAAII,gBACvBC,eAAkBL,EAAIK,eACtBC,SAAYN,EAAIM,SAChBC,SAAYP,EAAIO,aAKtB,SAASC,eAAeC,GAEtB,OAAOC,MAAK,WACVC,KAAKC,IAAI,MACTD,KAAKE,MAAM,OAAQ,CACjBC,MAAO,KAETH,KAAKE,MAAM,kBAAmB,CAC5BC,MAAO,IAETH,KAAKE,MAAM,iBAAkB,CAC3BC,MAAO,IAETH,KAAKE,MAAM,YAEX,IAAK,IAAIE,KAAUN,EACjBE,KAAKK,IAAID,MAKf,SAASE,SAASC,EAAGC,EAAKV,GAExBS,EAAEE,iBAEF,IAAIC,EAAaC,EAAE,gBAAgBC,MAE/BC,EAAaC,SAASC,eAAe,cACzCF,EAAWG,UAAY,GAGvB,IAAIC,EAAUT,EAAIU,OAAOR,GAMzB,IAAKS,UAJkB,IAAnBF,EAAQG,SACVP,EAAWG,UAAY,+DAGVC,GAAS,CACtB,IAAI3B,EAAK6B,OAAOlB,IAEZoB,EAAiBvB,EAAMR,GAAIM,SAAS0B,QAAQ,KAAM,IAGlDC,EAAa,cAAcF,kCAFf,YAAYA,UAAuB/B,QAEyCQ,EAAMR,GAAIE,WAEpE,KAA9BM,EAAMR,GAAIG,kBACZ8B,GAAc,QAAQzB,EAAMR,GAAIG,mBAAmBK,EAAMR,GAAII,kBAG/D6B,GAAc,+CAA+CzB,EAAMR,GAAIK,6DAA6DG,EAAMR,GAAIM,uBAE9IiB,EAAWG,WAAaO,GAI5BZ,EAAEG,UAAUU,OAAMzC,iBAChB,IAAIe,QAAcd,WACdwB,EAAMX,eAAeC,GAErB2B,EAAU,GACd,IAAI,IAAIrB,KAAUN,EAChB2B,EAAQrB,EAAOd,IAAMc,EAGvBU,SAASC,eAAe,gBAAgBW,iBAAiB,SAAS,SAASC,GACzErB,SAASqB,EAAOnB,EAAKiB,MAGvBX,SAASC,eAAe,eAAeW,iBAAiB,WAAW,SAASC,GACtEb,SAASC,eAAe,eAAea,MAAMR,QAAU,GACzDN,SAASC,eAAe,gBAAgBc,UAAW,EACnDlB,EAAE,eAAemB,YAAY,aAC7BnB,EAAE,oBAAoBoB,SAAS,aAET,KAAlBJ,EAAMK,SACP1B,SAASqB,EAAOnB,EAAKiB,KAIxBX,SAASC,eAAe,gBAAgBc,UAAW,EACnDlB,EAAE,eAAeoB,SAAS,aAC1BpB,EAAE,oBAAoBmB,YAAY","file":"search.js","sourcesContent":["async function loadJson() {\n  let response = await fetch (\"media.json\");\n  let json = await response.json();\n\n  return json.map(tmp => (\n    {\n      \"id\": tmp.itemBarcode,\n      \"name\": tmp.name,\n      \"authorFirstName\": tmp.authorFirstName,\n      \"authorLastName\": tmp.authorLastName,\n      \"category\": tmp.category,\n      \"location\": tmp.location\n    }\n  ));\n}\n\nfunction loadSearchData(media) {\n  // Create a new Index\n  return lunr(function() {\n    this.ref(\"id\");\n    this.field(\"name\", {\n      boost: 10\n    });\n    this.field(\"authorFirstName\", {\n      boost: 5\n    });\n    this.field(\"authorLastName\", {\n      boost: 5\n    });\n    this.field(\"category\");\n\n    for (let medium of media) {\n      this.add(medium);\n    }\n  });\n}\n\nfunction doSearch(e, idx, media) {\n  // Stop the default action\n  e.preventDefault();\n\n  let searchText = $(\"#searchField\").val();\n\n  let resultList = document.getElementById(\"resultList\");\n  resultList.innerHTML = \"\";\n\n  // Find the results from lunr\n  let results = idx.search(searchText);\n\n  if (results.length === 0) {\n    resultList.innerHTML = '<div class=\"notification is-danger\">Keine Ergebnisse!</div>';\n  }\n\n  for (result of results) {\n    let id = result.ref;\n\n    let targetLocation = media[id].location.replace(/ /g, \"\");\n    let targetUrl = `location_${targetLocation}.html#${id}`;\n\n    let targetLink = `<li class=\"${targetLocation}\"><span class=\"book\"><a href=\"${targetUrl}\">${media[id].name}</a>`\n\n    if (media[id].authorFirstName !== \"\") {\n      targetLink += ` von ${media[id].authorFirstName} ${media[id].authorLastName}`; // In case the book has an author\n    }\n\n    targetLink += ` <span class=\"category is-size-7 is-italic\">${media[id].category}</span></span><span class=\"location\"> am Standort ${media[id].location}</span></li>`;\n\n    resultList.innerHTML += targetLink;\n  }\n}\n\n$(document).ready(async function() {\n  let media = await loadJson();\n  let idx = loadSearchData(media);\n\n  let indexed = {};\n  for(let medium of media) {\n    indexed[medium.id] = medium;\n  }\n\n  document.getElementById(\"searchButton\").addEventListener(\"click\", function(event) {\n    doSearch(event, idx, indexed);\n  });\n\n  document.getElementById(\"searchField\").addEventListener(\"keydown\", function(event) {\n    if (document.getElementById(\"searchField\").value.length >= 3) {\n      document.getElementById(\"searchButton\").disabled = false;\n      $(\"searchField\").removeClass(\"is-danger\");\n      $(\"#fourCharWarning\").addClass(\"is-hidden\");\n\n      if (event.keyCode === 13) {\n         doSearch(event, idx, indexed);\n      }\n\n    } else {\n      document.getElementById(\"searchButton\").disabled = true;\n      $(\"searchField\").addClass(\"is-danger\");\n      $(\"#fourCharWarning\").removeClass(\"is-hidden\");\n    }\n  });\n});\n"]}